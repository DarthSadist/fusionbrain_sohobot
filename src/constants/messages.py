from typing import Final, Dict
from enum import Enum

class MessageKey(str, Enum):
    """–ö–ª—é—á–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π"""
    WELCOME = "welcome"
    HELP = "help"
    PROMPT = "prompt"
    GENERATING = "generating"
    REMOVING_BG = "removing_bg"
    REMOVE_BG_SUCCESS = "remove_bg_success"
    REMOVE_BG_ERROR = "remove_bg_error"
    ERROR = "error"
    SUCCESS = "success"
    SETTINGS = "settings"
    STYLE = "style"
    SIZE = "size"
    REMOVE_BG = "remove_bg"
    MAIN_MENU = "main_menu"
    CURRENT_SETTINGS = "current_settings"
    STYLE_CHANGED = "style_changed"
    SIZE_CHANGED = "size_changed"
    BG_REMOVED = "bg_removed"
    ERROR_GEN = "error_gen"
    ERROR_SIZE = "error_size"
    ERROR_CRITICAL = "error_critical"
    IMAGE_INFO = "image_info"

class MessageTemplate:
    """–®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏"""
    
    _templates: Final[Dict[str, str]] = {
        MessageKey.WELCOME: """
üé® <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ FusionBrain Art Bot!</b>

–Ø –ø–æ–º–æ–≥—É –≤–∞–º —Å–æ–∑–¥–∞–≤–∞—Ç—å —É–¥–∏–≤–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ Kandinsky 2.2

<b>–ú–æ–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:</b>
‚ú® –°–æ–∑–¥–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é
üé≠ –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
üìè –†–∞–∑–ª–∏—á–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã (1024x1024, 1024x1536 –∏ –¥—Ä.)
üé® –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å—Ç–∏–ª–µ–π

<b>–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É:</b>
1. –ù–∞–∂–º–∏—Ç–µ üé® <b>–°–æ–∑–¥–∞—Ç—å</b>
2. –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å –∏ —Ä–∞–∑–º–µ—Ä
3. –û–ø–∏—à–∏—Ç–µ –∂–µ–ª–∞–µ–º–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ‚ùì –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π —Å–ø—Ä–∞–≤–∫–∏
""",
        MessageKey.HELP: """
<b>üé® –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞</b>

<b>1. –°–æ–∑–¥–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</b>
‚Ä¢ –ù–∞–∂–º–∏—Ç–µ üé® <b>–°–æ–∑–¥–∞—Ç—å</b>
‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
‚Ä¢ –û–ø–∏—à–∏—Ç–µ, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–≤–∏–¥–µ—Ç—å
‚Ä¢ –î–æ–∂–¥–∏—Ç–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

<b>2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ ‚öôÔ∏è</b>
‚Ä¢ –†–∞–∑–º–µ—Ä: –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
‚Ä¢ –°—Ç–∏–ª—å: —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏

<b>3. –†–∞–±–æ—Ç–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º:</b>
‚Ä¢ üñº –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞
‚Ä¢ üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
‚Ä¢ üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

<b>4. –°–æ–≤–µ—Ç—ã –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é:</b>
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è
‚Ä¢ –£–∫–∞–∑—ã–≤–∞–π—Ç–µ —Å—Ç–∏–ª—å, —Ü–≤–µ—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
‚Ä¢ –ü—Ä–∏–º–µ—Ä: "–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –∫–∏—Ç –ø–ª—ã–≤–µ—Ç —Å—Ä–µ–¥–∏ –∑–≤–µ–∑–¥, –Ω–µ–æ–Ω–æ–≤—ã–µ —Ü–≤–µ—Ç–∞"
""",
        MessageKey.PROMPT: """
‚úçÔ∏è <b>–°–æ–∑–¥–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</b>

üé® –°—Ç–∏–ª—å: <b>{{style}}</b>
üìè –†–∞–∑–º–µ—Ä: <b>{{size}}</b>

‚úçÔ∏è –û–ø–∏—à–∏—Ç–µ –∂–µ–ª–∞–µ–º–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:
""",
        MessageKey.GENERATING: """
‚è≥ <b>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...</b>

–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è.
üé® –°—Ç–∏–ª—å: <b>{style}</b>
""",
        MessageKey.REMOVING_BG: """
‚è≥ <b>–£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞...</b>

–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è.
""",
        MessageKey.REMOVE_BG_SUCCESS: """
‚úÖ <b>–§–æ–Ω —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!</b>
""",
        MessageKey.REMOVE_BG_ERROR: """
‚ùå <b>–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ñ–æ–Ω–∞</b>

{{error_message}}

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.
""",
        MessageKey.ERROR: """
‚ùå <b>–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞</b>

{{error_message}}

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.
""",
        MessageKey.SUCCESS: """
‚úÖ <b>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ!</b>

<b>üìù –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:</b>
üé® –°—Ç–∏–ª—å: <b>{{style}}</b>
üìè –†–∞–∑–º–µ—Ä: <b>{{size}}</b>
‚ö°Ô∏è –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: <b>{{generation_time}}</b>

<b>‚úçÔ∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç:</b>
{{prompt}}

<b>üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:</b>
üìä ID –º–æ–¥–µ–ª–∏: <b>{{model_id}}</b>
üîç ID –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: <code>{{image_id}}</code>
""",
        MessageKey.SETTINGS: """
‚öôÔ∏è <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</b>

–¢–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
üìè –†–∞–∑–º–µ—Ä: <b>{{size}}</b>
üé® –°—Ç–∏–ª—å: <b>{{style}}</b>
""",
        MessageKey.STYLE: """
üé® <b>–í—ã–±–æ—Ä —Å—Ç–∏–ª—è</b>

–¢–µ–∫—É—â–∏–π —Å—Ç–∏–ª—å: <b>{{style}}</b>
""",
        MessageKey.SIZE: """
üìè <b>–í—ã–±–æ—Ä —Ä–∞–∑–º–µ—Ä–∞</b>

–¢–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä: <b>{{size}}</b>
""",
        MessageKey.REMOVE_BG: """
üñº <b>–£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞</b>

{{status}}
""",
        MessageKey.MAIN_MENU: "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
        MessageKey.CURRENT_SETTINGS: """
‚öôÔ∏è <b>–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</b>

üé® –°—Ç–∏–ª—å: <b>{style}</b>
üìè –†–∞–∑–º–µ—Ä: <b>{size}</b>

‚úçÔ∏è –û–ø–∏—à–∏—Ç–µ –∂–µ–ª–∞–µ–º–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
""",
        MessageKey.STYLE_CHANGED: """
‚úÖ <b>–°—Ç–∏–ª—å –∏–∑–º–µ–Ω–µ–Ω</b>

–¢–µ–∫—É—â–∏–π —Å—Ç–∏–ª—å: <b>{style}</b>
""",
        MessageKey.SIZE_CHANGED: """
‚úÖ <b>–†–∞–∑–º–µ—Ä –∏–∑–º–µ–Ω–µ–Ω</b>

–¢–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä: <b>{size}</b>
""",
        MessageKey.BG_REMOVED: "‚úÖ –§–æ–Ω —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!",
        MessageKey.ERROR_GEN: """
‚ùå <b>–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</b>

{error}

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:
‚Ä¢ –ò–∑–º–µ–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ
‚Ä¢ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π —Å—Ç–∏–ª—å
‚Ä¢ –£–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
""",
        MessageKey.ERROR_SIZE: "‚ùå –û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä",
        MessageKey.ERROR_CRITICAL: "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞",
        MessageKey.IMAGE_INFO: """
<b>üìù –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏</b>

<b>–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:</b>
üé® –°—Ç–∏–ª—å: <b>{style}</b>
üìè –†–∞–∑–º–µ—Ä: <b>{size}</b>
‚ö°Ô∏è –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: <b>{generation_time}</b>
{bg_removal_info}

<b>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç:</b>
‚úçÔ∏è <code>{prompt}</code>

<b>–ü—Ä–µ—Ñ–∏–∫—Å —Å—Ç–∏–ª—è:</b>
üé≠ <code>{style_prompt}</code>

<b>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:</b>
üìä ID –º–æ–¥–µ–ª–∏: <b>{model_id}</b>
üîç ID –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: <code>{image_id}</code>
‚è∞ –°–æ–∑–¥–∞–Ω–æ: <b>{created_at}</b>
""",
    }

    @classmethod
    def get(cls, key: MessageKey, **kwargs) -> str:
        """
        –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ –∫–ª—é—á—É
        
        Args:
            key: –ö–ª—é—á —Å–æ–æ–±—â–µ–Ω–∏—è
            **kwargs: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            
        Returns:
            str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            
        Raises:
            KeyError: –ï—Å–ª–∏ –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω
            ValueError: –ï—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        """
        if key not in cls._templates:
            raise KeyError(f"Message template not found: {key}")
            
        template = cls._templates[key]
        try:
            return template.format(**kwargs) if kwargs else template
        except KeyError as e:
            raise ValueError(f"Missing required parameter for message {key}: {e}")

    @classmethod
    def get_image_info(cls, image_info) -> str:
        """
        –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏
        
        Args:
            image_info: –û–±—ä–µ–∫—Ç ImageInfo
            
        Returns:
            str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
        """
        bg_removal_info = ""
        if image_info.has_removed_bg:
            bg_time = image_info.get_bg_removal_time_str()
            bg_removal_info = f"\n‚ö°Ô∏è –í—Ä–µ–º—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ–Ω–∞: <b>{bg_time}</b>"

        return cls.get(
            MessageKey.IMAGE_INFO,
            style=image_info.style,
            size=image_info.get_size_str(),
            generation_time=image_info.get_generation_time_str(),
            bg_removal_info=bg_removal_info,
            prompt=image_info.prompt,
            style_prompt=image_info.style_prompt,
            model_id=image_info.model_id,
            image_id=image_info.id,
            created_at=image_info.created_at.strftime("%Y-%m-%d %H:%M:%S")
        )

    @classmethod
    def validate_all_templates(cls):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —à–∞–±–ª–æ–Ω–æ–≤ –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å"""
        for key in MessageKey:
            if key not in cls._templates:
                raise ValueError(f"Missing template for key: {key}")
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞–ª–∏—á–∏–µ —à–∞–±–ª–æ–Ω–∞ –∏ –µ–≥–æ –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
            template = cls._templates[key]
            if not isinstance(template, str):
                raise ValueError(f"Template for key {key} must be a string")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —à–∞–±–ª–æ–Ω—ã –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –º–æ–¥—É–ª—è
MessageTemplate.validate_all_templates()
